<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Interface with Alpine.js</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Phudu:wght@700&display=swap');

        .heading-custom {
            font-family: 'Phudu', cursive;
            font-size: 40px;
            font-weight: 700;
            line-height: 44px;
            text-align: center;
        }
        h6 {
            font-family: 'Phudu', cursive;
            font-size: 20px;
            font-weight: 700;
            line-height: 20px;
            text-align: center;
        }
        .choose-btn {
            background-color: white;
        }
        .image-card img {
            max-width: 100%;
            border-radius: 15px;
        }
        [x-cloak] {
            display: none;
        }
        .date-text{
        font-family: Phudu;
        font-size: 13px;
        font-weight: 500;
        line-height: 15.93px;
        text-align: left;

        .day-text{
        font-family: Phudu;
        font-size: 24px;
        font-weight: 600;
        line-height: 29.4px;
        text-align: left;

        }
        .container-date {
    /* Ensure the container has a fixed height to control scrolling */
    height: 100px; /* Adjust as needed */
    overflow-x: auto; /* Enable horizontal scrolling */
    overflow-y: hidden; /* Hide vertical overflow */
}

.day-item {
    flex-shrink: 0; /* Prevent items from shrinking */
}
.active-time {
        background-color: #28a745; /* Green for available */
        color: white;
    }
    
    .inactive-time {
        background-color: #dc3545; /* Red for unavailable */
        color: white;
    }

        }
    </style>
</head>
<body x-data="app()" x-cloak style="background-color: #fbf4ec;">

    <!-- Start Screen -->
    <template x-if="currentScreen === 'start'">
        <div class="container my-3">
            <div class="row">
                <div class="col-12 mb-3">
                    <div class="image-card text-center mb-3">
                        <img src="https://example.com/court-image.jpg" alt="Court Image">
                    </div>
                    <div class="card p-3 text-center" style="background-color: #F9D5A7; border-radius: 15px;">
                        <h2 class="heading-custom">HIT THE COURT, MAKE YOUR MARK</h2>
                        <h5>Start Playing</h5>
                        <p>Across <span>4</span> Locations in Surat</p>
                        <button class="btn btn-outline-dark rounded-pill px-4" @click="navigate('selectCourt')">Play Now</button>
                    </div>
                </div>
                <div class="col-12">
                    <div class="card p-3 text-center" style="background-color: #B3DFF2; border-radius: 15px;">
                        <h5>MEMBERSHIP</h5>
                        <p><span>5</span> Live - 2 Upcoming</p>
                        <button class="btn btn-outline-dark rounded-pill px-4">Become a Member</button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Select Court Screen -->
    <template x-if="currentScreen === 'selectCourt'">
        <div>
            <div class="text-center col-12 p-4" style="background-color: #B3DFF2;">
                <h2 class="heading-custom">Where Would You Like To Play?</h2>
                <p class="text-muted" x-text="courts.message.length + ' courts available'"></p>
            </div>
            <div class="container my-3">
                <template x-for="court in courts.message" :key="court.name">
                    <div class="card mb-3 bg-transparent border border-0">
                        <img :src="court.image" alt="Court Image" class="img-fluid">
                        <div class="p-2 d-flex justify-content-between">
                            <div>
                                <h6 x-text="court.name"></h6>
                                <p x-text="court.location"></p>
                            </div>
                            <button class="btn btn-outline-dark choose-btn" @click="selectCourt(court.name)">Choose</button>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </template>

    <!-- Select Date and Time Screen -->
    <!-- Select Date and Time Screen -->
<template x-if="currentScreen === 'selectDateTime'">
    <div x-data="fetchAvailableDays()">
        <div class="text-center col-12 p-4" style="background-color: #B3DFF2;">
            <h2 class="heading-custom">When Would You Like to Play?</h2>
        </div>

        <div class="container container-date my-3">
            <div class="d-flex overflow-auto" style="scroll-behavior: smooth;">
                <template x-for="day in days" :key="day.date">
                    <div class="day-item text-white" style="background-color:#321D1D; width: 64px; height: 72px; border-radius: 15px; margin-right: 8px;">
                        <h6 class="date-text text-center pt-2" x-text="day.dayName"></h6>
                        <h6 class="day-text text-center" x-text="day.date"></h6>
                    </div>
                </template>
            </div>
        </div>

        <!-- Time Selection -->
        <div class="time-container my-3">
            <h4>Available Times:</h4>
            <div class="d-flex flex-wrap">
                <template x-for="time in availableTimes" :key="time">
                    <div class="time-slot" :class="{'active-time': time.isAvailable, 'inactive-time': !time.isAvailable}" style="width: 80px; margin: 5px; text-align: center;">
                        <p x-text="time.time"></p>
                    </div>
                </template>
            </div>
        </div>
    </div>
</template>

    <!-- Select Available Courts Screen -->
    <template x-if="currentScreen === 'selectAvailableCourts'">
        <div class="container my-3">
            <div class="row">
                <div class="col-12 mb-3">
                    <button class="btn btn-outline-dark mb-3" @click="navigate('selectDateTime')">
                        <span>&larr;</span> Back
                    </button>
                    <div class="card p-3 text-center" style="background-color: #B3DFF2; border-radius: 15px;">
                        <h2 class="heading-custom">Available Courts</h2>
                        <h5>Outdoor Courts</h5>
                        <div class="mb-3">
                            <button class="btn btn-outline-dark mb-2" @click="selectOutdoorCourt('Outdoor Court 1')">Outdoor Court 1</button>
                            <button class="btn btn-outline-dark mb-2" @click="selectOutdoorCourt('Outdoor Court 2')">Outdoor Court 2</button>
                        </div>
                        <h5>Indoor Courts</h5>
                        <div>
                            <button class="btn btn-outline-dark mb-2" @click="selectIndoorCourt('Indoor Court 1')">Indoor Court 1</button>
                            <button class="btn btn-outline-dark mb-2" @click="selectIndoorCourt('Indoor Court 2')">Indoor Court 2</button>
                        </div>
                        <button class="btn btn-outline-dark mt-3" @click="navigate('selectNumberOfPlayers')">Next</button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Select Number of Players Screen -->
    <template x-if="currentScreen === 'selectNumberOfPlayers'">
        <div class="container my-3">
            <div class="row">
                <div class="col-12 mb-3">
                    <button class="btn btn-outline-dark mb-3" @click="navigate('selectAvailableCourts')">
                        <span>&larr;</span> Back
                    </button>
                    <div class="card p-3 text-center" style="background-color: #B3DFF2; border-radius: 15px;">
                        <h2 class="heading-custom">Select Number of Players</h2>
                        <div>
                            <button class="btn btn-outline-dark mx-2" @click="selectPlayers(1)">1 Player</button>
                            <button class="btn btn-outline-dark mx-2" @click="selectPlayers(2)">2 Players</button>
                            <button class="btn btn-outline-dark mx-2" @click="selectPlayers(3)">3 Players</button>
                            <button class="btn btn-outline-dark mx-2" @click="selectPlayers(4)">4 Players</button>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-outline-dark" @click="navigate('confirmation')">Next</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Confirmation Screen -->
    <template x-if="currentScreen === 'confirmation'">
        <div class="container my-3">
            <div class="row">
                <div class="col-12 mb-3">
                    <div class="card p-3 text-center" style="background-color: #B3DFF2; border-radius: 15px;">
                        <h2 class="heading-custom">Booking Confirmation</h2>
                        <p x-text="'Court: ' + selectedCourt"></p>
                        <p x-text="'Date: ' + selectedDate"></p>
                        <p x-text="'Time: ' + selectedTime"></p>
                        <p x-text="'Players: ' + numberOfPlayers"></p>
                        <button class="btn btn-outline-dark" @click="navigate('start')">Confirm</button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script>
        function app() {
            return {
                currentScreen: 'start',
                courts: [],
                selectedCourt: '',
                selectedDate: '',
                selectedTime: '',
                numberOfPlayers: 1,
                days: [],  // To hold the days fetched from API
                availableTimes: [],  // To hold the time slots fetched for the selected day
                
                navigate(screen) {
                    if (screen === 'selectCourt') {
                        this.fetchCourts();
                    } else if (screen === 'selectDateTime' && this.selectedCourt) {
                        this.fetchAvailableDays(); // Fetch days when navigating to select date/time
                    }
                    this.currentScreen = screen;
                },
    
                async fetchCourts() {
                    try {
                        const response = await fetch('http://localhost:92/api/method/dinks.api.get_courts'); // Update with your API endpoint
                        this.courts = await response.json();
                    } catch (error) {
                        console.error('Error fetching courts:', error);
                    }
                },
    
                selectCourt(courtName) {
                    this.selectedCourt = courtName;
                    this.navigate('selectDateTime');
                },
    
                selectPlayers(count) {
                    this.numberOfPlayers = count;
                },
    
                async fetchAvailableDays() {
                    try {
                        const response = await fetch(`http://localhost:92/api/method/dinks.api.get_court_schedules?court_name=${this.selectedCourt}`);
                        const data = await response.json();
                        this.processScheduleData(data.message);
                    } catch (error) {
                        console.error('Error fetching schedule:', error);
                    }
                },
    
                processScheduleData(scheduleData) {
                    const daySet = new Set();  // To keep track of unique dates
                    const timeSlots = ['0:00:00', '1:00:00', '2:00:00', '3:00:00', '4:00:00', '5:00:00', '6:00:00', '7:00:00', '8:00:00', '9:00:00', '10:00:00']; // Add more if needed
                    const availableTimesMap = {}; // To map times to their availability
    
                    scheduleData.forEach(schedule => {
                        daySet.add(schedule.date);
                        availableTimesMap[schedule.time] = false; // Marking time as booked
                    });
    
                    this.days = Array.from(daySet).map(date => {
                        const [year, month, day] = date.split('-');
                        const dayName = new Date(date).toLocaleString('en-US', { weekday: 'short' });
                        return { dayName, date: day };
                    });
    
                    // Process available times based on the booked slots
                    this.availableTimes = timeSlots.map(slot => {
                        return {
                            time: slot,
                            isAvailable: !availableTimesMap[slot] // true if not booked
                        };
                    });
                },
    
                selectTime(time) {
                    this.selectedTime = time; // Set selected time
                },
            }
        }
    </script>
    
</body>
</html>
