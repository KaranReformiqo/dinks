import{g as N,l as ee}from"../chunks/localStore.svelte.CDHequDN.js";import{r as E}from"../chunks/index.De_1-CT6.js";import{f as U}from"../chunks/fetcher.4lFdTOTx.js";import{a as d,t as S,c as q,b as te}from"../chunks/disclose-version.BIyVqMZ8.js";import{p as ae,l as oe,f as z,a as re,g as P,c as v,e as ne,r as y,s as T,M as J,t as F}from"../chunks/runtime.DQwr1dzu.js";import{s as H}from"../chunks/render.CzK0qdHo.js";import{i as K}from"../chunks/if.D6id4Gaz.js";import{S as se,e as Q,i as R}from"../chunks/StepHeader.lqymEL4A.js";import{c as ie}from"../chunks/4.DfxuSM3A.js";import{C as le}from"../chunks/calendar.RBZLsofO.js";import{C as ce}from"../chunks/Container.CbVs3Ov9.js";import{f as de,d as me}from"../chunks/utils.B-A_uK2n.js";import{B as pe}from"../chunks/Button.CAviRttS.js";import{S as fe}from"../chunks/StickyPay.D8ElPGKo.js";import{g as ue}from"../chunks/entry.D73BxDQa.js";const ve=async()=>{var C,B;const t=N("booking");if(N("courts"),!((C=t==null?void 0:t.court_location)!=null&&C.name))throw E(300,"/buy/play-now");if(!(t!=null&&t.date))throw E(300,"/buy/play-now/date-time");if(!(t!=null&&t.player))throw E(300,"/buy/play-now/choose-players");const{morning:l=[],afternoon:e=[],evening:M=[]}=N("timeSlots")||{},{data:$=[]}=await U("/api/method/dinks.api.get_rates"),m=$.find(p=>{var f;return p.day.toLowerCase().includes(((f=t.weekday)==null?void 0:f.toLowerCase())||"")}),{data:g}=await U("/api/method/dinks.api.check_if_user_has_membership",{method:"POST",body:{phone:t.phone}}),_=((B=t.timeSchedules)==null?void 0:B.map(p=>{var o;const f=l.includes(p)?"Morning":e.includes(p)?"Afternoon":"Evening";let I=0;for(const c in(m==null?void 0:m.categories)||{})if(c.toLowerCase()==f.toLowerCase()){I=((o=m==null?void 0:m.categories)==null?void 0:o[c])||0;break}return I}).reduce((p,f)=>p+f,0))||0;return{totalPrice:g?(_*.8).toFixed(0):_,beforeDiscountPrice:g?_:0,hasMembership:g,timeGroups:{morning:l,afternoon:e,evening:M}}},Ae=Object.freeze(Object.defineProperty({__proto__:null,load:ve},Symbol.toStringTag,{value:"Module"}));var ye=S('<h4 class="mb-4 flex items-center justify-center gap-1 text-base font-bold"><!> Booking Details</h4>'),_e=S('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle opacity="0.1" cx="10" cy="10" r="10" fill="#321D1D"></circle></svg>'),xe=S("<span> </span>"),he=S('<div class="flex items-center justify-between border-b border-solid border-secondary px-6 py-4"><p class="flex items-center gap-2 text-[13px] font-medium leading-[16px] text-secondary"><!> </p> <p class="flex flex-col text-base font-bold leading-[20px] text-secondary"><!></p></div>'),ge=S('<div class="relative rounded-xl border border-secondary px-5 py-10"><div class="absolute inset-x-0 -top-5 flex justify-center"><!></div> <!></div>'),be=S('<div class="flex flex-col gap-[40px]"><!> <!></div> <!>',1);function Ne(t,l){var I;ae(l,!0);let e=ee("booking",{});const M=async()=>{const{data:o,status:c}=await U("/api/method/dinks.api.get_payment_link",{method:"POST",body:{...e.value,amount:l.data.totalPrice}});if(c!==200){e.value.paylink&&(window.location=e.value.paylink);return}e.value.paylink=o,window.location=o};function $(){const o=e.value.timeSchedules||[],c=Object.values(l.data.timeGroups).flat(),r=new Map;let u=0;for(const a of c)r.set(a,u),u+=1;let x=[],D=0,b=0;o.sort();for(const[a,n]of r)for(const s of o)s===a&&(n-D!==1&&(b+=1),x[b]||(x[b]=[]),x[b].push(s),D=n);console.log("timeGroup",x);let w=x.map(a=>a.length===1?a[0]:`${a[0]}-${a[a.length-1]}`).filter(Boolean);return w=w.map(a=>{const[n,s]=a.split("-"),j=r.get(s)+1,k=c[j];return k?`${n}-${k}`:s?`${n}-${s}`:n}),w}const m={Location:((I=e.value.court_location)==null?void 0:I.location)||"",Date:de(e.value.date||0,"w, WM yyyy"),Time:$(),Court:e.value.court_number?`Court ${e.value.court_number}`:"No preference","No. of Players":e.value.player===1?"1 Player":`${e.value.player} Players`,"Booking By":e.value.first_name+" "+e.value.last_name,Email:e.value.email,Phone:e.value.phone};oe(()=>{console.log(e.value,l.data)});var g=be(),_=z(g),C=v(_);se(C,{backUrl:"/buy/play-now/choose-players",headerText:"confirm your details",children:(o,c)=>{var r=ye(),u=v(r);le(u),ne(),y(r),d(o,r)},$$slots:{default:!0}});var B=T(C,2);ce(B,{children:(o,c)=>{var r=ge(),u=v(r),x=v(u);pe(x,{class:"w-max",text:"Booking Details",arrow:!1,action:()=>{}}),y(u);var D=T(u,2);Q(D,17,()=>Object.entries(m),R,(b,w)=>{let a=()=>P(w)[0],n=()=>P(w)[1];var s=he();const j=J(()=>me[a()]);var k=v(s),V=v(k);K(V,()=>P(j),h=>{var i=q(),L=z(i);ie(L,()=>P(j),(O,G)=>{G(O,{})}),d(h,i)},h=>{var i=_e();d(h,i)});var X=T(V);y(k);var W=T(k,2),Y=v(W);K(Y,()=>Array.isArray(n()),h=>{var i=q(),L=z(i);Q(L,17,n,R,(O,G)=>{var A=xe(),Z=v(A);y(A),F(()=>H(Z,P(G))),d(O,A)}),d(h,i)},h=>{var i=te();F(()=>H(i,n())),d(h,i)}),y(W),y(s),F(()=>H(X,` ${a()??""}`)),d(b,s)}),y(r),d(o,r)},$$slots:{default:!0}}),y(_);var p=T(_,2),f=J(()=>l.data.totalPrice||0);fe(p,{action:M,actionSecond:()=>ue("/buy/play-now/confirmation?pay_at_court=1"),btnText:"pay now",get prevPrice(){return l.data.beforeDiscountPrice},get price(){return P(f)}}),d(t,g),re()}export{Ne as component,Ae as universal};
