import{f as U}from"../chunks/fetcher.DLGVzAh-.js";import{g as oe,s as z,l as se}from"../chunks/localStore.svelte.-63o4dK4.js";import{r as re}from"../chunks/index.De_1-CT6.js";import{a as A,t as D}from"../chunks/disclose-version.BIyVqMZ8.js";import{z as ne,A as W,B as ie,au as le,I as de,G as ce,U as ue,J as me,p as fe,i as Z,l as pe,f as K,a as ge,g as e,c as w,e as ve,r as v,s as h,M as T,d as F,t as be}from"../chunks/runtime.DQwr1dzu.js";import{s as Q}from"../chunks/render.CzK0qdHo.js";import{S as _e,e as L,i as N}from"../chunks/StepHeader.BV7Si74-.js";import{c as he}from"../chunks/4.DfxuSM3A.js";import{C as R,s as ye}from"../chunks/Container.CbVs3Ov9.js";import{a as C}from"../chunks/props.BJuUnkrR.js";import{C as xe}from"../chunks/calendar.RBZLsofO.js";import{D as Se,T as we,M as Te,A as X}from"../chunks/afternoon.DeyIn_xk.js";import{g as ke}from"../chunks/entry.DqunF37E.js";import{S as Oe}from"../chunks/StickyBtn.C9PZ6Sn1.js";import{f as Me}from"../chunks/utils.B-A_uK2n.js";function Ae(b,n,d){W&&ie();var _=b,s=ue,a;ne(()=>{le(s,s=n())&&(a&&de(a),a=ce(()=>d(_)))}),W&&(_=me)}const Ce=[{court_number:"5",status:"Booked"},{court_number:"4",status:"Available"},{court_number:"3",status:"Available"},{court_number:"2",status:"Available"},{court_number:"1",status:"Available"}],De=async()=>{var I,y;const b=oe("booking");if(!((I=b==null?void 0:b.court_location)!=null&&I.name))throw re(300,"/buy/play-now");const{data:n=[]}=await U("/api/method/dinks.api.get_next_30_days?location="+((y=b.court_location)==null?void 0:y.name)),{data:{morning:d,afternoon:_,evening:s}}=await U("/api/method/dinks.api.get_time_slots"),a=n.map(k=>{const P=k.courts||Ce;return k.weekday,{...k,courts:P}});z("dateOptions",a),z("timeSlots",{morning:d,afternoon:_,evening:s}),console.log("morning, afternoon, evening");const{data:j=[]}=await U("/api/method/dinks.api.get_rates");return{dateOptions:a,morning:d,afternoon:_,evening:s,rates:j}},Xe=Object.freeze(Object.defineProperty({__proto__:null,load:De},Symbol.toStringTag,{value:"Module"}));var Ie=D('<h4 class="mb-4 flex items-center justify-center gap-1 text-base font-bold"><!> Date & Time</h4>'),je=D('<div class="scrollbar-sm scrollbar flex h-[73.54px] gap-5 overflow-x-auto pb-2"></div>'),Pe=D('<div class="flex flex-col items-center justify-center gap-1 rounded-xl bg-[--bg] p-5"><h4 class="mb-1 flex gap-1 text-base font-bold"><span class="icon-parent h-5 w-5"><!></span> </h4> <p class="mb-2 font-medium"> </p> <div class="grid w-max grid-cols-3 gap-2"></div></div>'),He=D('<p class="text-small text-center">Select minimum 2 slots</p> <div class="flex flex-col gap-3"></div>',1),Be=D('<div class="flex flex-col gap-[40px]"><!> <!> <!></div> <!>',1);function Ye(b,n){fe(n,!0),console.log("Hello from play-now page",n.data);let d=se("booking",{});const _=t=>{var c,f;const l=((c=t.find(i=>!i.disabled))==null?void 0:c.time)||"",o=((f=t.find(i=>l!==i.time&&!i.disabled))==null?void 0:f.time)||"";for(const i of e(a)){const m=t.find(r=>r.time===i);(!m||m.disabled)&&F(a,C(e(a).filter(r=>r!==i)))}!e(a).length&&e(s)&&e(a).push(l,o)};let s=Z(C(d.value.date||"")),a=Z(C(d.value.timeSchedules||[]));const j=()=>{const t=n.data.dateOptions.find(l=>l.date===e(s));console.log("selectedTimeSchedules",e(a)),console.log("dateOption",t),t&&e(a).length&&(z("courts",t.courts||[]),d.value.date=t.date,d.value.day=t.day,d.value.weekday=t.weekday,d.value.timeSchedules=e(a),ke("/buy/play-now/choose-court"))},I=t=>[{title:"Morning",options:n.data.morning||[],icon:Te,bg:"#C6E5BA"},{title:"Afternoon",options:n.data.afternoon||[],icon:X,bg:"#FEF092"},{title:"Evening",options:n.data.evening||[],icon:X,bg:"#F9C4C4"}].map(({title:o,options:c,icon:f,bg:i})=>{const m=c.map(r=>{if(Me(new Date,"yyyy-MM-dd")==t){const O=new Date().getHours(),M=new Date().getMinutes(),B=O*1e3+M,x=r.includes("PM"),p=r.replace(" AM","").replace(" PM",""),E=p.startsWith("12"),S=parseInt(p.split(":")[0]);let u=S+12*Number(x);E&&(u=x?12:0);const g=parseInt(p.split(":")[1]);return u*1e3+g<B?{time:r,_scheduleHour:S,scheduleHour:u,scheduleStr:p,scheduleIsPM:x,disabled:!0}:{time:r,_scheduleHour:S,scheduleHour:u,scheduleStr:p,scheduleIsPM:x,disabled:!1}}return{time:r,disabled:!1}});return{title:o,icon:f,bg:i,options:m}});let y=T(()=>I(e(s))),k=T(()=>e(y).map(t=>t.options).flat()),P=T(()=>n.data.dateOptions.find(t=>t.date===e(s))),Y=T(()=>n.data.rates.find(t=>{var l,o;return t.day.toLowerCase().includes(((o=(l=e(P))==null?void 0:l.weekday)==null?void 0:o.toLowerCase())||"")}));pe(()=>{_(e(k)),console.log({timeSchedulesOptions:e(y)})});var V=Be(),H=K(V),q=w(H);_e(q,{backUrl:"/buy/play-now",headerText:"where would you like to play?",children:(t,l)=>{var o=Ie(),c=w(o);xe(c),ve(),v(o),A(t,o)},$$slots:{default:!0}});var G=h(q,2);R(G,{children:(t,l)=>{var o=je();L(o,21,()=>n.data.dateOptions,N,(c,f)=>{Se(c,{get dateOption(){return e(f)},get selected(){return e(s)},set selected(i){F(s,C(i))}})}),v(o),A(t,o)},$$slots:{default:!0}});var $=h(G,2);Ae($,()=>e(s),t=>{R(t,{children:(l,o)=>{var c=He(),f=h(K(c),2);L(f,21,()=>e(y),N,(i,m)=>{var r=Pe(),O=w(r),M=w(O),B=w(M);he(B,()=>e(m).icon,(u,g)=>{g(u,{})}),v(M);var x=h(M);v(O);var p=h(O,2),E=w(p);v(p);var S=h(p,2);L(S,21,()=>e(m).options,N,(u,g)=>{var J=T(()=>({time:e(g).time,courts:[]}));we(u,{get schedule(){return e(J)},get selecteds(){return e(a)},set selecteds(ae){F(a,C(ae))},get disabled(){return e(g).disabled}})}),v(S),v(r),be(()=>{var u,g;ye(r,"style",`--bg: ${e(m).bg??""}`),Q(x,` ${e(m).title??""}`),Q(E,`â‚¹${((g=(u=e(Y))==null?void 0:u.categories)==null?void 0:g[e(m).title])??""}`)}),A(i,r)}),v(f),A(l,c)},$$slots:{default:!0}})}),v(H);var ee=h(H,2),te=T(()=>!(e(a).length>1&&e(s)));Oe(ee,{get disabled(){return e(te)},btnText:"Choose Date and Time",action:j}),A(b,V),ge()}export{Ye as component,Xe as universal};
