import{g as z,l as ae}from"../chunks/localStore.svelte.QUohhVdP.js";import{r as F}from"../chunks/index.De_1-CT6.js";import{f as W}from"../chunks/fetcher.4lFdTOTx.js";import{a as d,t as k,c as K,b as oe}from"../chunks/disclose-version.BIyVqMZ8.js";import{p as re,l as ne,f as H,a as se,g as P,c as v,e as ie,r as y,s as C,M as Q,t as U}from"../chunks/runtime.DQwr1dzu.js";import{s as V}from"../chunks/render.CzK0qdHo.js";import{i as R}from"../chunks/if.D6id4Gaz.js";import{S as le,e as X,i as Y}from"../chunks/StepHeader.C_smfx83.js";import{c as ce}from"../chunks/4.DfxuSM3A.js";import{C as de}from"../chunks/calendar.RBZLsofO.js";import{C as me}from"../chunks/Container.CbVs3Ov9.js";import{f as pe,d as fe}from"../chunks/utils.B-A_uK2n.js";import{B as ue}from"../chunks/Button.CAviRttS.js";import{S as ve}from"../chunks/StickyPay.D8ElPGKo.js";import{g as ye}from"../chunks/entry.BiDInLaF.js";const _e=async()=>{var M,g;const t=z("booking");if(z("courts"),!((M=t==null?void 0:t.court_location)!=null&&M.name))throw F(300,"/buy/play-now");if(!(t!=null&&t.date))throw F(300,"/buy/play-now/date-time");if(!(t!=null&&t.player))throw F(300,"/buy/play-now/choose-players");const{morning:l=[],afternoon:e=[],evening:O=[]}=z("timeSlots")||{},{data:I=[]}=await W("/api/method/dinks.api.get_rates"),m=I.find(c=>{var p;return c.day.toLowerCase().includes(((p=t.weekday)==null?void 0:p.toLowerCase())||"")}),{data:S}=await W("/api/method/dinks.api.check_if_user_has_membership",{method:"POST",body:{phone:t.phone}}),T=((g=t.timeSchedules)==null?void 0:g.map(c=>{var D;const p=l.includes(c)?"Morning":e.includes(c)?"Afternoon":"Evening";let B=0;for(const $ in(m==null?void 0:m.categories)||{})if($.toLowerCase()==p.toLowerCase()){B=((D=m==null?void 0:m.categories)==null?void 0:D[$])||0;break}return B}).reduce((c,p)=>c+p,0))||0;return{totalPrice:S?(T*.8).toFixed(0):T,beforeDiscountPrice:S?T:0,hasMembership:S,timeGroups:{morning:l,afternoon:e,evening:O}}},Ee=Object.freeze(Object.defineProperty({__proto__:null,load:_e},Symbol.toStringTag,{value:"Module"}));var xe=k('<h4 class="mb-4 flex items-center justify-center gap-1 text-base font-bold"><!> Booking Details</h4>'),ge=k('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle opacity="0.1" cx="10" cy="10" r="10" fill="#321D1D"></circle></svg>'),he=k("<span> </span>"),be=k('<div class="flex items-center justify-between border-b border-solid border-secondary px-6 py-4"><p class="flex items-center gap-2 text-[13px] font-medium leading-[16px] text-secondary"><!> </p> <p class="flex flex-col text-sm font-bold leading-[16px] text-secondary"><!></p></div>'),we=k('<div class="relative rounded-xl border border-secondary px-5 py-10"><div class="absolute inset-x-0 -top-5 flex justify-center"><!></div> <!></div>'),Pe=k('<div class="flex flex-col gap-[40px]"><!> <!></div> <!>',1);function ze(t,l){var $;re(l,!0);let e=ae("booking",{});const O=async()=>{const{data:o,status:f}=await W("/api/method/dinks.api.get_payment_link",{method:"POST",body:{...e.value,amount:l.data.totalPrice}});if(f!==200){e.value.paylink&&(window.location=e.value.paylink);return}e.value.paylink=o,window.location=o};function I(){const o=e.value.timeSchedules||[],f=Object.values(l.data.timeGroups).flat(),r=new Map;let u=0;for(const a of f)r.set(a,u),u+=1;let _=[],j=0,h=0;o.sort();for(const[a,n]of r)for(const s of o)s===a&&(n-j!==1&&(h+=1),_[h]||(_[h]=[]),_[h].push(s),j=n);console.log("timeGroup",_);let b=_.map(a=>a.length===1?a[0]:`${a[0]}-${a[a.length-1]}`).filter(Boolean);return b=b.map(a=>{const[n,s]=a.split("-"),L=r.get(s)+1,w=f[L]||(s==="11:30 PM"?"12:00 AM":"")||(n==="11:30 PM"?"12:00 AM":"");return w?`${n}-${w}`:s?`${n}-${s}`:n}),b}const m=o=>{const f=o[0].replace(/^-.*$/,""),r=o[o.length-1].replace(/[\w]*-$/,"");return`${f} - ${r}`},S=I();e.value.time_period=m(S);const T={Location:(($=e.value.court_location)==null?void 0:$.location)||"",Date:pe(e.value.date||0,"w, WM yyyy"),Time:I(),Court:e.value.court_number?`Court ${e.value.court_number}`:"No preference","No. of Players":e.value.player===1?"1 Player":`${e.value.player} Players`,"Booking By":e.value.first_name+" "+e.value.last_name,Email:e.value.email,Phone:e.value.phone};ne(()=>{console.log(e.value,l.data)});var M=Pe(),g=H(M),c=v(g);le(c,{backUrl:"/buy/play-now/choose-players",headerText:"confirm your details",children:(o,f)=>{var r=xe(),u=v(r);de(u),ie(),y(r),d(o,r)},$$slots:{default:!0}});var p=C(c,2);me(p,{children:(o,f)=>{var r=we(),u=v(r),_=v(u);ue(_,{class:"w-max",text:"Booking Details",arrow:!1,action:()=>{}}),y(u);var j=C(u,2);X(j,17,()=>Object.entries(T),Y,(h,b)=>{let a=()=>P(b)[0],n=()=>P(b)[1];var s=be();const L=Q(()=>fe[a()]);var w=v(s),q=v(w);R(q,()=>P(L),x=>{var i=K(),A=H(i);ce(A,()=>P(L),(G,N)=>{N(G,{})}),d(x,i)},x=>{var i=ge();d(x,i)});var Z=C(q);y(w);var J=C(w,2),ee=v(J);R(ee,()=>Array.isArray(n()),x=>{var i=K(),A=H(i);X(A,17,n,Y,(G,N)=>{var E=he(),te=v(E);y(E),U(()=>V(te,P(N))),d(G,E)}),d(x,i)},x=>{var i=oe();U(()=>V(i,n())),d(x,i)}),y(J),y(s),U(()=>V(Z,` ${a()??""}`)),d(h,s)}),y(r),d(o,r)},$$slots:{default:!0}}),y(g);var B=C(g,2),D=Q(()=>l.data.totalPrice||0);ve(B,{action:O,actionSecond:()=>ye("/buy/play-now/confirmation?pay_at_court=1"),btnText:"pay now",get prevPrice(){return l.data.beforeDiscountPrice},get price(){return P(D)}}),d(t,M),se()}export{ze as component,Ee as universal};
