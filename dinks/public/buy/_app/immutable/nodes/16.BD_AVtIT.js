import{f as F}from"../chunks/fetcher.4lFdTOTx.js";import{g as te,s as z,l as ae}from"../chunks/localStore.svelte.C6oJC2U9.js";import{r as oe}from"../chunks/index.De_1-CT6.js";import{a as T,t as M}from"../chunks/disclose-version.DrGQ82ci.js";import{z as se,A as W,B as re,au as ne,I as ie,G as le,a6 as de,J as ce,p as ue,i as Z,l as me,f as fe,a as pe,g as e,c as x,e as ge,r as f,s as S,O as w,d as L,t as ve}from"../chunks/runtime.BJTCq859.js";import{s as K}from"../chunks/render.XsSmxe_d.js";import{S as be,e as N,i as U}from"../chunks/StepHeader.BxBrpBax.js";import{c as _e}from"../chunks/4.DuSXMZJ5.js";import{C as Q,s as he}from"../chunks/Container.CvBsLdK3.js";import{a as C}from"../chunks/props.pnIqOiY9.js";import{C as ye}from"../chunks/calendar.DWdC8sJS.js";import{D as xe,T as Se,M as we,A as R}from"../chunks/afternoon.__KuZko7.js";import{g as Oe}from"../chunks/entry.CkapZUbK.js";import{S as ke}from"../chunks/StickyBtn.mMhx41y-.js";import{f as Te}from"../chunks/utils.CS4LV-3w.js";function Ce(p,n,d){W&&re();var b=p,s=de,a;se(()=>{ne(s,s=n())&&(a&&ie(a),a=le(()=>d(b)))}),W&&(b=ce)}const Me=[{court_number:"5",status:"Booked"},{court_number:"4",status:"Available"},{court_number:"3",status:"Available"},{court_number:"2",status:"Available"},{court_number:"1",status:"Available"}],Ae=async()=>{var A,h;const p=te("booking");if(!((A=p==null?void 0:p.court_location)!=null&&A.name))throw oe(300,"/buy/play-now");const{data:n=[]}=await F("/api/method/dinks.api.get_next_30_days?location="+((h=p.court_location)==null?void 0:h.name)),{data:{morning:d,afternoon:b,evening:s}}=await F("/api/method/dinks.api.get_time_slots"),a=n.map(O=>{const j=O.courts||Me;return O.weekday,{...O,courts:j}});z("dateOptions",a),z("timeSlots",{morning:d,afternoon:b,evening:s}),console.log("morning, afternoon, evening");const{data:I=[]}=await F("/api/method/dinks.api.get_rates");return{dateOptions:a,morning:d,afternoon:b,evening:s,rates:I}},Re=Object.freeze(Object.defineProperty({__proto__:null,load:Ae},Symbol.toStringTag,{value:"Module"}));var De=M('<h4 class="mb-4 flex items-center justify-center gap-1 text-base font-bold"><!> Date & Time</h4>'),Ie=M('<div class="scrollbar-sm scrollbar flex h-[73.54px] gap-5 overflow-x-auto pb-2"></div>'),je=M('<div class="flex flex-col items-center justify-center gap-1 rounded-xl bg-[--bg] p-5"><h4 class="mb-1 flex gap-1 text-base font-bold"><span class="icon-parent h-5 w-5"><!></span> </h4> <p class="mb-2 font-medium"> </p> <div class="grid w-max grid-cols-3 gap-2"></div></div>'),Pe=M('<div class="flex flex-col gap-3"></div>'),He=M('<div class="flex flex-col gap-[40px]"><!> <!> <!></div> <!>',1);function Xe(p,n){ue(n,!0),console.log("Hello from play-now page",n.data);let d=ae("booking",{});const b=t=>{var o;const c=((o=t.find(r=>!r.disabled))==null?void 0:o.time)||"";for(const r of e(a)){const g=t.find(i=>i.time===r);(!g||g.disabled)&&L(a,C(e(a).filter(i=>i!==r)))}!e(a).length&&e(s)&&e(a).push(c)};let s=Z(C(d.value.date||"")),a=Z(C(d.value.timeSchedules||[]));const I=()=>{const t=n.data.dateOptions.find(c=>c.date===e(s));console.log("selectedTimeSchedules",e(a)),console.log("dateOption",t),t&&e(a).length&&(z("courts",t.courts||[]),d.value.date=t.date,d.value.day=t.day,d.value.weekday=t.weekday,d.value.timeSchedules=e(a),Oe("/buy/play-now/choose-court"))},A=t=>[{title:"Morning",options:n.data.morning||[],icon:we,bg:"#C6E5BA"},{title:"Afternoon",options:n.data.afternoon||[],icon:R,bg:"#FEF092"},{title:"Evening",options:n.data.evening||[],icon:R,bg:"#F9C4C4"}].map(({title:o,options:r,icon:g,bg:i})=>{const y=r.map(m=>{if(Te(new Date,"yyyy-MM-dd")==t){const k=new Date().getHours(),H=new Date().getMinutes(),B=k*1e3+H,v=m.includes("PM"),_=m.replace(" AM","").replace(" PM",""),D=_.startsWith("12"),u=parseInt(_.split(":")[0]);let l=u+12*Number(v);D&&(l=v?12:0);const E=parseInt(_.split(":")[1]);return l*1e3+E<B?{time:m,_scheduleHour:u,scheduleHour:l,scheduleStr:_,scheduleIsPM:v,disabled:!0}:{time:m,_scheduleHour:u,scheduleHour:l,scheduleStr:_,scheduleIsPM:v,disabled:!1}}return{time:m,disabled:!1}});return{title:o,icon:g,bg:i,options:y}});let h=w(()=>A(e(s))),O=w(()=>e(h).map(t=>t.options).flat()),j=w(()=>n.data.dateOptions.find(t=>t.date===e(s))),X=w(()=>n.data.rates.find(t=>{var c,o;return t.day.toLowerCase().includes(((o=(c=e(j))==null?void 0:c.weekday)==null?void 0:o.toLowerCase())||"")}));me(()=>{b(e(O)),console.log({timeSchedulesOptions:e(h)})});var V=He(),P=fe(V),q=x(P);be(q,{backUrl:"/buy/play-now",headerText:"where would you like to play?",children:(t,c)=>{var o=De(),r=x(o);ye(r),ge(),f(o),T(t,o)},$$slots:{default:!0}});var G=S(q,2);Q(G,{children:(t,c)=>{var o=Ie();N(o,21,()=>n.data.dateOptions,U,(r,g)=>{xe(r,{get dateOption(){return e(g)},get selected(){return e(s)},set selected(i){L(s,C(i))}})}),f(o),T(t,o)},$$slots:{default:!0}});var Y=S(G,2);Ce(Y,()=>e(s),t=>{Q(t,{children:(c,o)=>{var r=Pe();N(r,21,()=>e(h),U,(g,i)=>{var y=je(),m=x(y),k=x(m),H=x(k);_e(H,()=>e(i).icon,(u,l)=>{l(u,{})}),f(k);var B=S(k);f(m);var v=S(m,2),_=x(v);f(v);var D=S(v,2);N(D,21,()=>e(i).options,U,(u,l)=>{var E=w(()=>({time:e(l).time,courts:[]}));Se(u,{get schedule(){return e(E)},get selecteds(){return e(a)},set selecteds(J){L(a,C(J))},get disabled(){return e(l).disabled}})}),f(D),f(y),ve(()=>{var u,l;he(y,"style",`--bg: ${e(i).bg??""}`),K(B,` ${e(i).title??""}`),K(_,`â‚¹${((l=(u=e(X))==null?void 0:u.categories)==null?void 0:l[e(i).title])??""}`)}),T(g,y)}),f(r),T(c,r)},$$slots:{default:!0}})}),f(P);var $=S(P,2),ee=w(()=>!(e(a).length>1&&e(s)));ke($,{get disabled(){return e(ee)},btnText:"Choose Date and Time",action:I}),T(p,V),pe()}export{Xe as component,Re as universal};
